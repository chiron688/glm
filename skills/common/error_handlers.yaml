error_handlers:
  - name: "dismiss_update_prompt"
    trigger: before_step
    when:
      text_any_contains: "{{update_prompt_markers}}"
    actions:
      - action: Tap
        target:
          type: selector
          selector:
            text: "{{rx_later}}"
            match: regex
    resolution: continue

  - name: "permission_allow"
    trigger: before_step
    when:
      text_any_contains: "{{allow_markers}}"
    actions:
      - action: RunSkill
        skill_id: "permission_allow_popup"
    resolution: continue

  - name: "network_retry"
    trigger: on_error
    codes: ["POSTCONDITION_FAILED", "SCREEN_MISMATCH", "TARGET_NOT_FOUND"]
    when:
      text_any_contains: "{{network_error_markers}}"
    actions:
      - action: Tap
        target:
          type: selector
          selector:
            text: "{{rx_retry}}"
            match: regex
    retry:
      max_attempts: 2
      backoff_ms: 1000
      on_codes: ["POSTCONDITION_FAILED", "SCREEN_MISMATCH", "TARGET_NOT_FOUND"]
    resolution: retry

  - name: "login_required"
    trigger: on_error
    codes: ["SCREEN_MISMATCH", "POSTCONDITION_FAILED"]
    when:
      text_any_contains: "{{login_markers}}"
    actions:
      - action: RunSkill
        skill_id: "login_flow"
    resolution: escalate

  - name: "verification_required"
    trigger: on_error
    codes: ["SCREEN_MISMATCH", "POSTCONDITION_FAILED"]
    when:
      text_any_contains: "{{verification_markers}}"
    actions:
      - action: RunSkill
        skill_id: "verification_flow"
    resolution: escalate

  - name: "upload_failed_retry"
    trigger: on_error
    codes: ["POSTCONDITION_FAILED", "ACTION_FAILED"]
    when:
      text_any_contains: "{{upload_failed_markers}}"
    actions:
      - action: Tap
        target:
          type: selector
          selector:
            text: "{{rx_retry}}"
            match: regex
    retry:
      max_attempts: 2
      backoff_ms: 1500
      on_codes: ["POSTCONDITION_FAILED", "ACTION_FAILED"]
    resolution: retry
